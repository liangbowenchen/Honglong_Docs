# 一口气搞懂计算机网络常识

> 起因是队内小登之前在面临局域网通信时对ip地址的抽象讨论，反映出大家对这些网络概念的理解非常粗浅。虽然这些概念在小学，初中，高中的信息课上每回都要重新讲一遍，但迫于学校的应试教育可能从来没有真正的理解过他们究竟是什么。而与此同时，不光是视觉组在使用Ros局域网时会用到这些，这些网络常识对于我们电控组来说也同样重要。以下大部分内容在入学时的计算思维都讲过，忘干净的好好反思一下

## 什么是IP，Mac地址又是什么

### IPv4

还记得初高中信息课上的内容吗，计算机之间想要通信通过有线连接形成了各种网络结构，我们称之为网络拓扑。此处我们便直接从星形拓扑的网络开始，讲诉我们的内容，各个计算机将网线连接在交换机上形成一个互通的网络。

打开你的终端，输入`ipconfig`你会看到终端输出了各个网络适配器的信息（Linux中是`ifconfig`），这里我们只截取WLAN为例子

<img src="..\..\..\image\image-20250703110553107.png" alt="image-20250703110553107" style="zoom: 67%;" />

此时你看到的这一串数字就是你的IP地址。你可能发现，你的地址中既包含IPv4又包含IPv6,这是什么？他们有什么区别，不要慌我们从IPv4开始讲起

可以看到**此时**我们的IPv4地址是`192.168.84.53`（ps:注意我说的是"此时"，后面要考）。它是一串由4个8位二进制数组成的4个字节，这里我们用的十进制数表示，中间用点隔开，也就是说每一个数的范围是0到255。而这一串数字也就是在网络中找到你的**快递地址**。

打开你的浏览器，输入你默认网关的地址，此处我是`192.168.84.30`,如果你是连接的是robomaster的WIFI,你会来到我们路由器的管理界面，恭喜你，成功地通过IP地址访问到了我们的路由器。你也可以在终端中使用`ping`命令，输入你旁边队友的IP（不过前提是你俩都连的robomaster这个wifi）你会看到终端返回了你俩建立联系所花费的延时，恭喜你，成功的在网络中找到了你的好朋友。这里我连的不是robomaster，没朋友，以ping网关为例

<img src="..\..\..\image\image-20250703114003403.png" alt="image-20250703114003403" style="zoom: 67%;" />

有细心的小登可能已经发现,在刚才ipconfig页面中，IPv4地址的下一项是子网掩码，它长的结构和IP地址这么相似，但它的值却这么特殊他们到底是什么关系。接下来我们需要介绍**子网的概念**

以我们实验室为例，在207的这些设备连接在robomaster这个WiFi下通过战队这个路由器组成了一个网络，同样的对面208机创的设备也通过他们的路由器形成了他们的一个网络。很显然，当207和208的路由器没有相连时我们是无法访问到他们那边的设备的。因为我们是两个独立的网络，若想要建立联系，则需要把两个路由器连接起来，组成一个更大的网络，这样我们和机创的这两个小网就叫做**子网**

子网是将一个大的网络划分成多个较小的子网络，主要是为了对网络进行有效的管理，减少广播域的范围，从而提高网络的性能和安全性。而协议划分子网的依据便是将两者的IP**与子网掩码按位相与**，若结果相等则认为是同一子网。我们知道，任何一位二进制数与上0，则最后结果也是0，而与1则保持不变。以这个子网掩码`255.255.255.0`为例，和它相与的结果就是把IP地址的最后一个字节清零，也就变成了`192.168.84.0`。换言之，只要是192.168.84.xxx这样的IP就都是一个子网，称他们为**同一网段下的IP**。在实际中我们常常用子网掩码中1的个数来表示它，并用一个斜杠写在IP地址的后面，也就是`192.168.84.53/24`在你Windows网卡的硬件连接属性中就能看到这种表示。我们也能轻松地得到这个子网的最大设备数为2的(32-24)次方，为256个。

<img src="..\..\..\image\image-20250704100501676.png" alt="image-20250704100501676" style="zoom: 60%;" />

当我们普通地通过WIFI联网时，我们自己的IP地址是路由器分配的（这个自动分配就叫做DHCP,我们后面再说）同样的，子网掩码也是在路由器上设置。那么假设我有超过256个设备该怎么办，很显然只需要让子网掩码的1少写一个就行，变成`255.255.254.0`（再次提醒此处是用十进制数简写的8位二进制数）这样IP的子网的最大设备数就来到了512个。而**默认网关**，则通常是你路由器的LAN口IP,，它是你访问子网以外的唯一出口，后续我们在网络层在详细介绍

### IPv6

说完了IPv4,现在终于轮到IPv6了。如前所述，IPv4是32位二进制数，可以算得IPv4所有IP的数量为2的32次方等于4294967296，只有42亿个，而我们全球有80亿人，更别提从来没有人规定一个人只能有一台设备，IPv4远远不能满足需求，并已在2020年正式宣布枯竭,撑到现在完全靠的是**NAT（网络地址转换）**，这也是为什么我们难以访问到其它子网的重要原因，我们后面在提。为了应对需求，于是便发明了**IPv6**

和v4相似IPv6是由**128位二进制数**组成，通常用4个十六进制数表示16位2进制数并用冒号隔开称为一个**字段**，共8个字段。v4是一个uint整形，而v6是4个uint，其个数更是来到了10的32次方。可想而知，除非你星际殖民，ipv6几乎无穷无尽。在表示中，我们常常会将每一个字段的前导0省略，即以0开头的部分省略不写，同时将超过三个字段连续的0省略，记作双冒号，但该冒号省略法只能使用一次，否则无法确定字段的长度（8个字段减去没省略的，就是双冒号里0的字段数，若有两个双冒号则无法确定这俩分别是多少）。不过目前，由于v6和v4并不兼容，很多原有的网络设施不支持IPv6 ,因而IPv6的普及正在进行中，很不幸，实验室网络的IPv6并非公网IP，所以上层路由器就干脆没有开启v6的功能。上述`ipconfig`里的`fe80`开头的地址，叫做本地连接地址，相当于私网IP无法和外界连接使用。

### MAC

我们现在已经知道，IP表示了你的设备在网络中的位置，是网络地址（Internet Position）而在上面硬件连接属性的截图中我们能看到一个相似的东西，叫做物理地址MAC。它是出厂时就写在你的设备上，或者说网卡，是与实际的物理器件相绑定的一串数字，是独一无二的，由厂家决定，不可更改。早在IP地址出现之前，人们便已经使用MAC地址来进行局域网通信。在以太网发明后，IP才进入视野，主要负责的是网络之间的通信。而你所需要记住的是IP地址是可变的，你可以随时修改你咋网络上的位置，但MAC是与你的设备相绑定，永远不能修改，除非你换一张网卡。

## 网口 网线 网卡    ——物理层

有了上面的知识我们终于可以来到了计算机网络，最为一个大学生你可能不了解，但一定听过见过这些器件，我们再来重新认识一下它们

首先我们要知道的是，网络的传输分为有线和无线，我们正在使用的WIFI就是通过无线的方式获取网络的它叫做WLAN(Wireless Local  Area Network)无线局域网。而在有线传输中无非两种，一种是电信号而另一种则是光信号，也就是我们的网线和光纤。

### 网口

从网口开始，很简单，它是连接你网线和网卡的物理接口。我们平时常见的这些接口叫做`RJ45`俗称水晶头，这里我想说的是，我们的电脑不能直接处理光信号，除非你是光量子计算机。因此从光纤进来的网络必须经过光电转换模块，俗称**光猫**，除了我们家里常见的长得和路由器的光猫，还有一种小型的条状转换模块，可以直接插在服务器或电脑上的，我们一般将其叫做**猫棒**，前提是你得有专门的接口，叫做`SFP`,而在涉及到光电两种信号的语境中，为了区分我们会将它们叫做**光口**和**电口**

<img src="..\..\..\image\qq_pic_merged_1751598784648.jpg" alt="qq_pic_merged_1751598784648" style="zoom: 25%;" />

### 网线

网线不必多说，无非就是光纤和我们的双绞线，它的标准是以`cat`来的，也就是你平时听说的什么五类，六类，超五类这些，它描述了网线的传输和抗干扰性能，这里为了表诉方便，接下来后文的“网线”就特指电信号的线。**光纤**一般只有两个线一根作为RX一根作为TX是全双工的，其接口分为`SX`和`LX`分别表示short和long可以按大小区分。而**网线**和我们的CAN通信一样，内部是**4组差分线**，总共八根。目前来说，你能看见的线上有标的，最常见的，基本上就是**超五类**起步，在网线说能看到印刷的`cat5+`字样。是能跑到千兆网的基本配置，普通的五类网线`cat5`只能跑百兆。从六类开始，网线内部除了信号线以外还会多一根十字塑料架，为网线提供支撑，同时信号线本身也会更粗，你会看见水晶头内的网线的接口变成了两排，因为之前的一排八个已经放不下了，所以水晶头之间是不兼容的。要想满血的跑完万兆宽带最好使用到超六类。而后的网线无非就是在用料和抗干扰上下了更多功夫，像八类网线，最大速度达40Gps，一般是企业使用，普通人几乎用不上。 

### 网卡

网卡是连接你计算机与外部的模块，是你的数据与物理层的接口，相当于我们的CAN收发器。前面所说的IP地址，MAC都是记录在你的网卡上的，一个网卡只有一个IP。网卡本身走的是pcie协议到你的电脑，不过目前市面上也有许多USB网卡，他们即插即用但是稳定性远不如直插pcie的种类。关于无线网卡，这里不是装机教程，不做过多介绍，在品牌上只需要记得killer>inter>螃蟹即可。

## 网桥/交换机        ——数据链路层

从这一步开始我们便真正开始了网络的搭建。直接相连的电脑不必多说，但面临多台电脑该怎么办。很容易想到，像我们所用的can总线一样，把网线并在一起不就好了，每台电脑之间的通路就能打通。在这里我们就可以把交换机想象成这样一个集线器，各个设备相连后便能彼此建立连接，组成一个基本的网络。不过，若是这样简单的连接必然会面临一个问题，网线上传输的数据每个人都能收到，不论是对隐私还是负载都十分不利。而这，才是交换机真正的干的活，数据转发。

在交换机的内部，存储着各个端口与所连设备MAC地址的匹配关系。网络中设备发送的报文会包含目标MAC源MAC,以及目标IP和源IP,报文到达交换机后，交换机会在MAC地址表中查询目标MAC，如果成功找到，则将数据直接从该端口发出，就像是在源端口和目标端口之间搭建了一座桥梁，**网桥**便由此得名，而通过交换机的这种连接方式则叫做**桥接**，网桥和交换机的功能相似，但网桥出现的更早，交换机可以理解为性能更强，更智能的网桥，现在基本已经取代了网桥,你可以在虚拟化领域看到虚拟网桥，理解为交换机即可，相当于用软件的形式去实现交换机的硬件转发。

若是在MAC地址的查询过程中未找到则向所有端口广播该帧数据，而这个广播的过程就叫做**泛洪**，这样只要目标MAC在这个网络中，几经转折那它便一定能收到。得益于泛洪的机制，我们可以把多个交换机在连接起来，从而组成一个更大的网络。但现实中，网络的规模一旦大了起来，连通不同交换机的电脑想要通信就必须经过泛洪。这样一来网络中充斥着大量的广播信息，对资源又会造成巨大浪费。因此，我们把巨大的网络划分成若干子网，来限制它的广播域，而这也就涉及到了接下来的网关和路由器

## 网关/路由器        ——网络层

首先必须要指出的一点是，家用路由器其实是交换机、路由器，无线接入点（AP）三者的总合。平时的语境中一般只侧重了它的AP，因为平时也就只有你连WIFI的时候才会想起它。用一句话来表述就是，在家用网络中，一般由路由器来**担任**网关，从而实行路由的**功能**，并通过AP，无线连接到你的电脑。

前面讲IP的时候，我们已经提到了子网的概念，网关的作用就是来接通两个不同的子网，在这里为了方便描述，我们将其称之为内网和外网。在网关上，它拥有两张网卡，一张通向外网，连接WAN口，一张通相内网，与LAN口一起连接在交换机上，而你的WLAN，其实就是wireless LAN，无线LAN口的意思，通过wifi协议代替了网线。说到这里，想必应当能够相到网关是如何连通内外网的了吧，我们将内外网的网卡分别配置成内网和外网的网段，当路由器收到外网网段的目标IP就会把数据发向网关，网关接收后处理，再以自己外网的IP发送到外网，而这一个过程便叫做**路由**。路由器内部储存着路由表，它决定了网关的转发规则。如果目标IP不在路由表内，则将该包数据转发到下一级网关，层层递进完成包的发送。

NAT和DHCP

## TCP/UDP 和 https://       ——传输层和应用层

传输层，指的是我们在通信时收发数据的协议，相当于我们的串口，iic这些，它只管把数据发出去，把数据变成对应的电平信号。至于我要发什么，收的数据要怎么处理，这便是应用层的活，相当于战队代码上下位机通信的湖大seasky协议。而在计算机网络中，TCP/UDP便担任了网络的传输层，而网站前的http就属于我们的应用层。

我们直接从TCP开始，TCP在UDP的基础上多了一个相互连通。可以把UDP比喻为写邮件，对方收没收到，发送端都不知道。他们俩一个速度更快，一个稳定性更高。TCP这一个建立联系的过程就是我们所常说的**三次握手**。

应用层的协议其实有很多，涉及到更深的知识就不再我们的网络常识之内，这里只做简单介绍。http和https之间的关系是后者多了一个加密的过程，把传出的数据进行了处理，它们主要运用在网站web领域，除此之外，在嵌入式物联网中会使用到MQTT协议，我们平时远程连接终端的ssh,以及前面所说的DNS，arp他们都是基于TCP/UDP的应用层。





